<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Simb√≥lica Ecuaciones Lineales</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: #ffffff;
            padding: 0;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 1200px;
            overflow: hidden;
        }

        /* Header con informaci√≥n institucional */
        .header-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header-info::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .header-info::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -5%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-title {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .header-subtitle {
            font-size: 1.1em;
            opacity: 0.95;
            font-weight: 300;
            margin-bottom: 25px;
            letter-spacing: 0.5px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .info-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }

        .info-label {
            font-size: 0.85em;
            opacity: 0.85;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 6px;
            display: block;
        }

        .info-value {
            font-size: 1.15em;
            font-weight: 600;
            display: block;
        }

        /* Contenido principal */
        .main-content {
            padding: 45px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 35px;
            text-align: center;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            color: #34495e;
            border-bottom: 3px solid #667eea;
            padding-bottom: 12px;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        hr {
            border: 0;
            height: 2px;
            background: linear-gradient(to right, #667eea, #764ba2, #667eea);
            margin: 40px 0;
        }

        .solver-section {
            margin-bottom: 40px;
        }

        .solver-section p {
            margin-bottom: 15px;
            color: #555;
            font-size: 1.05em;
        }

        #ecuacion,
        #formulaLiteral {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1.1em;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }

        #ecuacion:focus,
        #formulaLiteral:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.3);
        }

        .formula-input-container {
            margin-bottom: 20px;
        }

        .formula-input-container label {
            display: block;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        .result-box {
            background-color: #f8f9fa;
            border: 2px solid #e0e0e0;
            padding: 20px;
            border-radius: 8px;
            font-size: 1.05em;
            color: #2c3e50;
            margin-top: 20px;
            min-height: 20px;
            border-left: 5px solid #667eea;
        }

        .result-box:empty {
            display: none;
        }

        .error-message {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 10px;
            min-height: 20px;
            padding: 10px;
            background-color: #fadbd8;
            border-radius: 4px;
            display: none;
        }

        .error-message:not(:empty) {
            display: block;
        }

        .result-box table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .result-box table thead {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .result-box table th,
        .result-box table td {
            padding: 15px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        .result-box table th {
            font-weight: 600;
        }

        .result-box table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .result-box table tbody tr:hover {
            background-color: #f0f3ff;
        }

        .result-box pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: #f0f3ff;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #667eea;
        }

        .result-box .formula-original {
            background: linear-gradient(135deg, #d5f4e6 0%, #e8f8f5 100%);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: 600;
            border-left: 4px solid #27ae60;
        }

        .result-box .nota-didactica {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin-top: 15px;
            font-size: 0.95em;
            color: #856404;
            border-radius: 4px;
        }

        .solution-display {
            background: linear-gradient(135deg, #d5f4e6 0%, #e8f8f5 100%);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid #27ae60;
            font-weight: 500;
        }

        strong {
            color: #2c3e50;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 25px;
            }

            h1 {
                font-size: 1.8em;
            }

            .header-info {
                padding: 25px;
            }

            .header-title {
                font-size: 1.8em;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header con informaci√≥n institucional -->
        <div class="header-info">
            <div class="header-content">
                <div class="header-title">üîß Calculadora Simb√≥lica</div>
                <div class="header-subtitle">Soluci√≥n de Ecuaciones Lineales y Despejes Algebraicos</div>
                
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">üìö Instituci√≥n</span>
                        <span class="info-value">Tecnol√≥gico de Software</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">üìñ Materia</span>
                        <span class="info-value">Fundamentos de √Ålgebra</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">üë®‚Äçüè´ Docente</span>
                        <span class="info-value">Jorge Javier Pedroza Romero</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">üë®‚Äçüíª Alumno</span>
                        <span class="info-value">Enrique Zavala</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">üë• Grupo</span>
                        <span class="info-value">C</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="main-content">
            <section class="solver-section">
                <h2>1. Soluci√≥n de Ecuaciones Lineales</h2>
                <p>Introduce la ecuaci√≥n lineal para despejar <strong>x</strong><br><small style="color: #888;">Ejemplo: 2x + 3 = x + 8</small></p>
                <input type="text" id="ecuacion" value="2x + 3 = x + 8" placeholder="Ej: 2x + 3 = x + 8">
                <button onclick="resolverEcuacionParseada()">üîç Resolver Ecuaci√≥n</button>
                <div id="resDespejeParseado" class="result-box"></div>
                <div id="mensajeError" class="error-message"></div>
            </section>

            <hr>

            <section class="solver-section">
                <h2>2. Despeje Simb√≥lico de F√≥rmulas</h2>
                <p>Introduce cualquier f√≥rmula matem√°tica para despejar todas las variables<br><small style="color: #888;">Ejemplo: C = 5(F - 32)/9</small></p>
                
                <div class="formula-input-container">
                    <label for="formulaLiteral">üìê F√≥rmula:</label>
                    <input type="text" id="formulaLiteral" value="C = 5(F - 32)/9" placeholder="Ej: T = F*c/r">
                </div>
                
                <button onclick="procesarFormulaLiteral()">‚öôÔ∏è Generar Despejes</button>
                <div id="resFormulaLiteral" class="result-box"></div>
                <div id="mensajeErrorFormula" class="error-message"></div>
            </section>
        </div>
    </div>

    <script>
        // Utility function to clean strings
        function cleanString(str) {
            return str.replace(/\s+/g, '');
        }

        // --- PART 1: Solving Linear Equations in One Variable (x) ---

        function resolverEcuacionParseada() {
            const ecuacionStr = document.getElementById('ecuacion').value;
            const resBox = document.getElementById('resDespejeParseado');
            const errorBox = document.getElementById('mensajeError');

            resBox.innerHTML = '';
            errorBox.innerText = '';

            try {
                const partes = ecuacionStr.split('=');
                if (partes.length !== 2) {
                    throw new Error("La ecuaci√≥n debe contener exactamente un signo '='");
                }

                const ladoIzq = partes[0].trim();
                const ladoDer = partes[1].trim();

                const ecuacionFormateada = `(${ladoIzq}) - (${ladoDer})`;

                const nodo = math.parse(ecuacionFormateada);
                const simplificado = math.simplify(nodo);

                const coeficientes = extraerCoeficientes(simplificado.toString());
                
                if (coeficientes.a === 0) {
                    throw new Error("La ecuaci√≥n no tiene soluci√≥n √∫nica (coeficiente de x es 0)");
                }

                const solucion = -coeficientes.b / coeficientes.a;

                resBox.innerHTML = `
                    <div class="formula-original">
                        <strong>üìù Ecuaci√≥n Original:</strong> ${ecuacionStr}
                    </div>
                    <div class="solution-display">
                        <strong>‚úÖ Soluci√≥n:</strong> x = ${parseFloat(solucion.toFixed(10))}
                    </div>
                    <p><strong>Simplificada:</strong> ${simplificado.toString()} = 0</p>
                `;
            } catch (error) {
                errorBox.innerText = `‚ùå Error: ${error.message}`;
            }
        }

        function extraerCoeficientes(ecuacion) {
            ecuacion = ecuacion.replace(/\s+/g, '');

            let a = 0;
            let b = 0;

            const regexX = /([+-]?\d*\.?\d*)\*?x/g;
            let match;
            while ((match = regexX.exec(ecuacion)) !== null) {
                let coef = match[1];
                if (coef === '' || coef === '+') coef = '1';
                if (coef === '-') coef = '-1';
                a += parseFloat(coef);
            }

            const sinX = ecuacion.replace(/[+-]?\d*\.?\d*\*?x/g, '');
            if (sinX) {
                try {
                    b = math.evaluate(sinX);
                } catch (e) {
                    b = 0;
                }
            }

            return { a, b };
        }

        // --- PART 2: Symbolic Formula Solving ---

        function extractVariables(formulaStr) {
            const matches = formulaStr.match(/[a-zA-Z][a-zA-Z0-9]*/g);
            if (!matches) return [];
            return Array.from(new Set(matches));
        }

        function despejarVariable(expresionOriginal, variableObjetivo, variableDespejada) {
            try {
                let expresion = expresionOriginal.replace(/\s+/g, '');

                const patronComplejo = /(\d*\.?\d*)\(([a-zA-Z]+)\s*([+-])\s*(\d+\.?\d*)\)\s*\/\s*(\d+\.?\d*)/;
                const matchComplejo = expresion.match(patronComplejo);

                if (matchComplejo && matchComplejo[2] === variableObjetivo) {
                    const coef1 = matchComplejo[1] || '1';
                    const operador = matchComplejo[3];
                    const constante = matchComplejo[4];
                    const divisor = matchComplejo[5];

                    const operadorInverso = operador === '-' ? '+' : '-';

                    if (coef1 === '1') {
                        return `(${variableDespejada}) * (${divisor}) ${operadorInverso} ${constante}`;
                    } else {
                        return `(${variableDespejada}) * (${divisor}) / (${coef1}) ${operadorInverso} ${constante}`;
                    }
                }

                if (expresion.includes('+') || expresion.includes('-')) {
                    const resultado = despejarSumaResta(expresion, variableObjetivo, variableDespejada);
                    if (resultado !== null) {
                        return resultado;
                    }
                }

                if (expresion.includes('/')) {
                    const partes = dividirPorOperadorPrincipal(expresion, '/');
                    const numerador = partes[0];
                    const denominador = partes[1];

                    if (numerador.includes(variableObjetivo)) {
                        if (numerador === variableObjetivo) {
                            return `(${variableDespejada}) * (${denominador})`;
                        } else {
                            const factoresNum = extraerFactoresMultiplicacion(numerador);
                            const otrosFactores = factoresNum.filter(f => f !== variableObjetivo);

                            if (otrosFactores.length === 0) {
                                return `(${variableDespejada}) * (${denominador})`;
                            } else {
                                return `(${variableDespejada}) * (${denominador}) / (${otrosFactores.join(' * ')})`;
                            }
                        }
                    } else if (denominador.includes(variableObjetivo)) {
                        if (denominador === variableObjetivo) {
                            return `(${numerador}) / (${variableDespejada})`;
                        } else {
                            const factoresDen = extraerFactoresMultiplicacion(denominador);
                            const otrosFactores = factoresDen.filter(f => f !== variableObjetivo);

                            if (otrosFactores.length === 0) {
                                return `(${numerador}) / (${variableDespejada})`;
                            } else {
                                return `(${numerador}) / ((${variableDespejada}) * (${otrosFactores.join(' * ')}))`;
                            }
                        }
                    }
                }

                if (expresion.includes('*')) {
                    const factores = extraerFactoresMultiplicacion(expresion);
                    const otrosFactores = factores.filter(f => f !== variableObjetivo);

                    if (otrosFactores.length === 0) {
                        return variableDespejada;
                    } else if (otrosFactores.length === 1) {
                        return `(${variableDespejada}) / (${otrosFactores[0]})`;
                    } else {
                        return `(${variableDespejada}) / (${otrosFactores.join(' * ')})`;
                    }
                }

                if (expresion === variableObjetivo) {
                    return variableDespejada;
                }

                return expresion;

            } catch (error) {
                return `Error: ${error.message}`;
            }
        }

        function despejarSumaResta(expresion, variableObjetivo, variableDespejada) {
            const terminos = parsearTerminos(expresion);

            let terminoConVariable = null;
            let otrosTerminos = [];

            for (const termino of terminos) {
                if (termino.texto.includes(variableObjetivo)) {
                    terminoConVariable = termino;
                } else {
                    otrosTerminos.push(termino);
                }
            }

            if (!terminoConVariable) {
                return null;
            }

            let resultado = variableDespejada;

            for (const termino of otrosTerminos) {
                const signoInverso = termino.signo === '+' ? '-' : '+';
                resultado += ` ${signoInverso} ${termino.texto}`;
            }

            if (terminoConVariable.texto !== variableObjetivo) {
                if (terminoConVariable.texto.includes('*')) {
                    const partes = terminoConVariable.texto.split('*');
                    const coef = partes.find(p => p !== variableObjetivo);
                    resultado = `(${resultado}) / (${coef})`;
                }
            }

            if (terminoConVariable.signo === '-') {
                resultado = `-(${resultado})`;
            }

            return resultado;
        }

        function parsearTerminos(expresion) {
            const terminos = [];
            let actual = '';
            let signo = '+';
            let nivel = 0;

            for (let i = 0; i < expresion.length; i++) {
                const char = expresion[i];

                if (char === '(') {
                    nivel++;
                    actual += char;
                } else if (char === ')') {
                    nivel--;
                    actual += char;
                } else if ((char === '+' || char === '-') && nivel === 0 && actual !== '') {
                    terminos.push({ signo: signo, texto: actual });
                    signo = char;
                    actual = '';
                } else if ((char === '+' || char === '-') && nivel === 0 && actual === '') {
                    signo = char;
                } else {
                    actual += char;
                }
            }

            if (actual) {
                terminos.push({ signo: signo, texto: actual });
            }

            return terminos;
        }

        function dividirPorOperadorPrincipal(expresion, operador) {
            let nivel = 0;
            let ultimaPosicion = -1;

            for (let i = expresion.length - 1; i >= 0; i--) {
                const char = expresion[i];

                if (char === ')') {
                    nivel++;
                } else if (char === '(') {
                    nivel--;
                } else if (char === operador && nivel === 0) {
                    ultimaPosicion = i;
                    break;
                }
            }

            if (ultimaPosicion === -1) {
                return [expresion];
            }

            const parte1 = expresion.substring(0, ultimaPosicion);
            const parte2 = expresion.substring(ultimaPosicion + 1);

            return [parte1, parte2];
        }

        function extraerFactoresMultiplicacion(expresion) {
            const factores = [];
            let actual = '';
            let nivel = 0;

            for (let i = 0; i < expresion.length; i++) {
                const char = expresion[i];

                if (char === '(') {
                    nivel++;
                    actual += char;
                } else if (char === ')') {
                    nivel--;
                    actual += char;
                } else if (char === '*' && nivel === 0) {
                    if (actual) {
                        factores.push(actual);
                        actual = '';
                    }
                } else {
                    actual += char;
                }
            }

            if (actual) {
                factores.push(actual);
            }

            return factores;
        }

        function procesarFormulaLiteral() {
            const formulaStr = document.getElementById('formulaLiteral').value;
            const resBox = document.getElementById('resFormulaLiteral');
            const errorBox = document.getElementById('mensajeErrorFormula');

            resBox.innerHTML = '';
            errorBox.innerText = '';

            try {
                const partes = formulaStr.split('=');
                if (partes.length !== 2) {
                    throw new Error("La f√≥rmula debe contener exactamente un signo '='");
                }

                const ladoIzq = partes[0].trim();
                const ladoDer = partes[1].trim();

                const variables = extractVariables(formulaStr);

                if (variables.length < 2) {
                    throw new Error("Se necesitan al menos 2 variables distintas en la f√≥rmula");
                }

                let htmlTable = `
                    <div class="formula-original">
                        <strong>üìê F√≥rmula Original:</strong> ${formulaStr}
                    </div>
                    <p><strong>üìä Variables detectadas:</strong> ${variables.join(', ')}</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Variable Despejada</th>
                                <th>F√≥rmula Resultante</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                for (const variable of variables) {
                    let formulaDespejada;

                    if (ladoIzq === variable) {
                        formulaDespejada = `${variable} = ${ladoDer}`;
                    } else {
                        const resultado = despejarVariable(ladoDer, variable, ladoIzq);
                        formulaDespejada = `${variable} = ${resultado}`;
                    }

                    htmlTable += `
                        <tr>
                            <td><strong>${variable}</strong></td>
                            <td><pre>${formulaDespejada}</pre></td>
                        </tr>
                    `;
                }

                htmlTable += `
                        </tbody>
                    </table>
                    <div class="nota-didactica">
                        <strong>üí° Nota:</strong> Los despejes se generan usando manipulaci√≥n algebraica directa.
                        Soporta suma, resta, multiplicaci√≥n, divisi√≥n y expresiones con par√©ntesis.
                    </div>
                `;

                resBox.innerHTML = htmlTable;

            } catch (error) {
                errorBox.innerText = `‚ùå Error: ${error.message}`;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            resolverEcuacionParseada();
        });
    </script>
</body>
</html>