<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Variables ‚Äî Fundamentos de √Ålgebra</title>

  <style>
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #0f172a;     /* slate-950 */
      --muted:#64748b;     /* slate-500 */
      --primary:#4f46e5;   /* indigo-600 */
      --primary-700:#4338ca;
      --ring: rgba(79,70,229,.25);

      --success:#16a34a;   /* green-600 */
      --error:#dc2626;     /* red-600 */
      --warning:#d97706;   /* amber-600 */

      --surface:#f1f5f9;   /* slate-100 */
      --border:#e5e7eb;
      --shadow: 0 12px 32px rgba(2,6,23,.08);
      --mono:#0b132b;
    }
    [data-theme="dark"]{
      --bg:#0b1220;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --primary:#8b5cf6;
      --primary-700:#7c3aed;
      --ring: rgba(139,92,246,.28);

      --success:#22c55e;
      --error:#ef4444;
      --warning:#f59e0b;

      --surface:#0b1324;
      --border:#1f2937;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono:#d1d5db;
    }

    *{ box-sizing:border-box }
    html,body{
      margin:0;
      padding:0;
      background:var(--bg);
      color:var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      line-height:1.5;
    }

    .hero{
      position: relative;
      padding: 48px 20px 28px;
      background: radial-gradient(1200px 400px at 0% -10%, rgba(79,70,229,.18), transparent 60%),
                  radial-gradient(1200px 400px at 100% -10%, rgba(236,72,153,.15), transparent 60%),
                  linear-gradient(180deg, rgba(2,6,23,.04), transparent);
      overflow:hidden;
    }
    .hero::after{
      content:'';
      position:absolute; inset:-2px;
      background:
        conic-gradient(from 0deg at 20% -10%, rgba(79,70,229,.10), transparent 30%) ,
        conic-gradient(from 180deg at 120% -10%, rgba(236,72,153,.10), transparent 30%);
      mask: linear-gradient(black, transparent 60%);
      pointer-events:none;
    }
    .hero-inner{
      max-width: 1040px;
      margin: 0 auto;
    }
    .title{
      display:flex; align-items:center; gap:12px;
      margin:0 0 6px 0;
      font-size: clamp(1.4rem, 2.4vw, 2rem);
      font-weight: 800;
      letter-spacing:.3px;
    }
    .title .logo{
      inline-size: 36px; block-size: 36px;
      display:grid; place-items:center;
      border-radius:10px;
      background: linear-gradient(135deg, var(--primary), #ec4899);
      color:white; font-weight:900;
      box-shadow: 0 8px 20px rgba(79,70,229,.35);
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size: .98rem;
    }

    .container{
      max-width: 1040px;
      margin: 18px auto 56px;
      padding: 0 20px;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
    }

    .info{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 10px 24px;
      padding: 20px 24px;
      margin-top: 12px;
      background: linear-gradient(90deg, rgba(227,242,253,.35) 0%, rgba(252,228,236,.35) 100%);
      border: 1px dashed rgba(100,116,139,.35);
      border-radius: 14px;
    }
    .info .row strong{
      color: var(--primary);
    }
    @media (max-width: 720px){
      .info{ grid-template-columns: 1fr; }
    }

    .toolbar{
      display:flex; justify-content:space-between; align-items:center;
      gap: 12px; margin: 18px 0 14px;
    }
    .left-tools, .right-tools{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .kbd{
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: .85rem;
      color: var(--muted);
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 8px 10px;
      border-radius: 10px;
    }

    .grid{
      display:grid; gap:16px;
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .field .label{
      display:flex; align-items:center; gap:8px;
      margin: 14px 4px 8px;
      font-weight: 700; color: var(--text);
    }
    .field .hint{
      margin: 0 4px 10px;
      color: var(--muted); font-size: .92rem;
    }

    textarea{
      width:100%;
      min-height: 160px;
      resize: vertical;
      padding: 14px 14px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: .98rem;
      line-height: 1.45;
      outline: none;
      transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
    }
    textarea::placeholder{ color: #94a3b8; }
    textarea:focus{
      border-color: var(--primary);
      box-shadow: 0 0 0 6px var(--ring);
    }

    .btn{
      appearance: none;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      font-weight: 600;
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform .05s ease, background .2s ease, border-color .2s ease, color .2s ease, box-shadow .2s ease;
    }
    .btn:hover{ background: var(--surface); }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(180deg, var(--primary), var(--primary-700));
      border-color: transparent;
      color: white;
      box-shadow: 0 10px 20px rgba(79,70,229,.35);
    }
    .btn-primary:hover{ filter: brightness(1.05); }
    .btn-ghost{
      background: transparent;
      border-color: var(--border);
    }
    .btn-danger{
      border-color: rgba(220,38,38,.25);
      color: var(--error);
      background: rgba(220,38,38,.05);
    }

    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin: 8px 0 6px;
    }

    .result-card{
      margin-top: 22px;
      padding: 18px 18px;
      display:flex; gap:14px; align-items:flex-start;
      border-left: 6px solid transparent;
    }
    .result-icon{
      inline-size: 28px; block-size: 28px;
      border-radius: 8px;
      display:grid; place-items:center;
      background: var(--surface);
      color: var(--muted);
      flex: 0 0 auto;
    }
    .result-content{
      white-space: pre-wrap;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      color: var(--mono);
      font-size: .98rem;
    }

    /* Estados */
    .is-success{ border-left-color: var(--success); }
    .is-success .result-icon{ background: rgba(22,163,74,.12); color: var(--success); }
    .is-error{ border-left-color: var(--error); }
    .is-error .result-icon{ background: rgba(220,38,38,.10); color: var(--error); }
    .is-warning{ border-left-color: var(--warning); }
    .is-warning .result-icon{ background: rgba(217,119,6,.10); color: var(--warning); }

    .footer{
      margin-top: 28px; color: var(--muted); font-size:.9rem;
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .toggle{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px; border-radius: 12px; border: 1px solid var(--border);
      background: var(--card);
    }
    .toggle input{ display:none; }
    .toggle .dot{
      inline-size: 32px; block-size: 24px; border-radius: 999px;
      background: var(--surface); position: relative; border: 1px solid var(--border);
    }
    .toggle .dot::after{
      content:'';
      position:absolute; top:2px; left:2px;
      inline-size: 18px; block-size: 18px; border-radius: 999px;
      background: var(--primary);
      transition: transform .2s ease;
      box-shadow: 0 4px 10px rgba(79,70,229,.35);
    }
    .toggle input:checked + .dot::after{ transform: translateX(8px); }
  </style>
</head>

<body data-theme="light">
  <header class="hero">
    <div class="hero-inner">
      <h1 class="title">
        <span class="logo">∆íx</span>
        Calculadora de Variables
      </h1>
      <p class="subtitle">Eval√∫a expresiones con variables y ecuaciones encadenadas. Tip: <strong>Ctrl + Enter</strong> para calcular.</p>
    </div>
  </header>

  <main class="container">
    <!-- Tarjeta de contexto institucional -->
    <section class="card info" aria-label="Informaci√≥n institucional">
      <div class="row"><strong>Instituci√≥n:</strong> Tecnol√≥gico de Software</div>
      <div class="row"><strong>Materia:</strong> Fundamentos de √Ålgebra</div>
      <div class="row"><strong>Docente:</strong> Jorge Javier Pedroza Romero</div>
      <div class="row"><strong>Alumno:</strong> Enrique Zavala</div>
      <div class="row"><strong>Grupo:</strong> C</div>
    </section>

    <div class="toolbar">
      <div class="left-tools">
        <span class="kbd" aria-hidden="true">Ctrl ‚åÉ + Enter ‚Üµ</span>
        <span class="kbd" aria-hidden="true">Evaluar</span>
      </div>
      <label class="toggle" title="Cambiar modo claro/oscuro">
        <span>üåû</span>
        <input id="theme-checkbox" type="checkbox" />
        <span class="dot" aria-hidden="true"></span>
        <span>üåô</span>
      </label>
    </div>

    <section class="card" style="padding: 18px;">
      <div class="grid">
        <div class="field">
          <div class="label">Variables</div>
          <p class="hint">Escribe una por l√≠nea o separadas por coma. Puedes asignar valores o expresiones. <br>
            <em>Ejemplos:</em> <code>w1 = 1</code>, <code>w2 = 2</code>, <code>base, altura = 3, area = base*altura/2</code>
          </p>
          <textarea id="variables" placeholder="Ejemplo:
w1 = 1
w2 = 2
w3 = 3
pi = 3.14159
r = 5"></textarea>
        </div>

        <div class="field">
          <div class="label">Ecuaciones</div>
          <p class="hint">Puedes encadenar: lo calculado se guarda como variable disponible para las siguientes l√≠neas.<br>
            The <em>Ejemplos:</em> <code>feature_cost = w1 * w2 + w3</code>, <code>circ = 2*pi*r</code>
          </p>
          <textarea id="equations" placeholder="Ejemplo:
feature_cost = w1 * w2 + w3
circ = 2*pi*r
circ"></textarea>
        </div>
      </div>

      <div class="actions">
        <button id="calculate-btn" class="btn btn-primary">Calcular</button>
        <button id="clear-btn" class="btn btn-danger">Limpiar</button>
        <button id="example-btn" class="btn btn-ghost">Cargar ejemplo</button>
      </div>

      <div id="result-card" class="card result-card is-warning" role="status" aria-live="polite">
        <div id="result-icon" class="result-icon">‚ÑπÔ∏è</div>
        <div>
          <h3 style="margin:0 0 6px 0;">Resultado</h3>
          <div id="result" class="result-content">Ingresa las variables y ecuaciones para ver el resultado</div>
        </div>
      </div>
    </section>

    <div class="footer">
      <div>Hecho con üíô para estudiar √Ålgebra.</div>
      <div style="opacity:.8">v1.0</div>
    </div>
  </main>

  <script>
    // Persistencia simple de tema en localStorage
    (function themeInit(){
      const saved = localStorage.getItem('calc-theme') || 'light';
      document.body.setAttribute('data-theme', saved);
      const checkbox = document.getElementById('theme-checkbox');
      checkbox.checked = (saved === 'dark');
      checkbox.addEventListener('change', () => {
        const mode = checkbox.checked ? 'dark' : 'light';
        document.body.setAttribute('data-theme', mode);
        localStorage.setItem('calc-theme', mode);
      });
    })();

    // ==========================
    //   Clase principal (tu base + mejoras de UI)
    // ==========================
    class Calculator {
      constructor() {
        this.variablesInput = document.getElementById('variables');
        this.equationsInput = document.getElementById('equations');
        this.calculateButton = document.getElementById('calculate-btn');
        this.clearButton = document.getElementById('clear-btn');
        this.exampleButton = document.getElementById('example-btn');

        this.resultCard = document.getElementById('result-card');
        this.resultIcon = document.getElementById('result-icon');
        this.resultDiv = document.getElementById('result');

        this.init();
      }

      init() {
        // Bot√≥n calcular
        this.calculateButton.addEventListener('click', () => this.calculate());

        // Ctrl+Enter en ambos textareas
        const onCtrlEnter = (e) => {
          if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            this.calculate();
          }
        };
        this.variablesInput.addEventListener('keydown', onCtrlEnter);
        this.equationsInput.addEventListener('keydown', onCtrlEnter);

        // Limpiar
        this.clearButton.addEventListener('click', () => {
          this.variablesInput.value = '';
          this.equationsInput.value = '';
          this.showResult('Ingresa las variables y ecuaciones para ver el resultado', 'warning');
        });

        // Ejemplo r√°pido
        this.exampleButton.addEventListener('click', () => {
          this.variablesInput.value = `w1 = 1
w2 = 2
w3 = 3
pi = 3.14159
r = 5`;

          this.equationsInput.value = `feature_cost = w1 * w2 + w3
circ = 2*pi*r
feature_cost
circ`;
          this.showResult('Ejemplo cargado. Presiona Calcular o Ctrl+Enter.', 'warning');
        });

        // Restaurar √∫ltimo estado (opcional)
        try{
          const savedVars = localStorage.getItem('calc-vars');
          const savedEq = localStorage.getItem('calc-eqs');
          if (savedVars) this.variablesInput.value = savedVars;
          if (savedEq) this.equationsInput.value = savedEq;
        }catch{}

        // Auto-guardado ligero
        const persist = () => {
          try{
            localStorage.setItem('calc-vars', this.variablesInput.value);
            localStorage.setItem('calc-eqs', this.equationsInput.value);
          }catch{}
        };
        this.variablesInput.addEventListener('input', persist);
        this.equationsInput.addEventListener('input', persist);
      }

      // Parsear las variables del campo de texto (tu l√≥gica, con m√≠nimos ajustes)
      parseVariables(variablesText) {
        const variables = {};
        const lines = variablesText.split('\n').filter(line => line.trim());

        for (const line of lines) {
          const trimmedLine = line.trim();
          if (!trimmedLine) continue;

          // Separar por comas para manejar m√∫ltiples declaraciones en una l√≠nea
          const parts = trimmedLine.split(',');

          for (const part of parts) {
            const trimmedPart = part.trim();
            if (!trimmedPart) continue;

            // Buscar asignaciones como "w1 = 1" o "variable = valor"
            const assignmentMatch = trimmedPart.match(/^(\w+)\s*=\s*(.+)$/);
            if (assignmentMatch) {
              const [, varName, value] = assignmentMatch;
              try {
                // Intentar evaluar el valor (puede ser num√©rico o una expresi√≥n)
                variables[varName.trim()] = this.evaluateExpression(value.trim(), variables);
              } catch (error) {
                throw new Error(`Error al evaluar la variable "${varName}": ${error.message}`);
              }
            } else {
              // Si no hay asignaci√≥n, asumir que es solo el nombre de la variable
              const varName = trimmedPart.trim();
              if (varName && !variables.hasOwnProperty(varName)) {
                variables[varName] = 0; // Valor por defecto
              }
            }
          }
        }

        return variables;
      }

      // Evaluar expresiones matem√°ticas (tu l√≥gica, mantenida)
      evaluateExpression(expression, variables) {
        // Validaci√≥n de caracteres permitidos
        if (!/^[a-zA-Z0-9+\-*/().\s^]+$/.test(expression)) {
          throw new Error(`Expresi√≥n contiene caracteres no v√°lidos: ${expression}`);
        }

        // Potencias: ^ -> **
        let processedExpression = expression.replace(/\^/g, '**');

        // Reemplazar variables conocidas en la expresi√≥n
        for (const [varName, value] of Object.entries(variables)) {
          const regex = new RegExp(`\\b${varName}\\b`, 'g');
          processedExpression = processedExpression.replace(regex, value);
        }

        // Verificar que no queden variables sin resolver
        if (/[a-zA-Z]/.test(processedExpression)) {
          const undefinedVars = processedExpression.match(/[a-zA-Z]+/g);
          // Evitar repetidos
          const unique = Array.from(new Set(undefinedVars));
          throw new Error(`Variables sin definir: ${unique.join(', ')}`);
        }

        try {
          return Function(`"use strict"; return (${processedExpression})`)();
        } catch (error) {
          throw new Error(`Error al evaluar: ${processedExpression}`);
        }
      }

      // Funci√≥n principal de c√°lculo (tu base + mejoras de UI)
      calculate() {
        try {
          const variablesText = this.variablesInput.value.trim();
          const equationsText = this.equationsInput.value.trim();

          if (!variablesText && !equationsText) {
            this.showResult('Por favor ingresa las variables y ecuaciones', 'error');
            return;
          }

          // Parsear variables
          const variables = this.parseVariables(variablesText);

          // Procesar ecuaciones
          const equations = equationsText.split('\n').filter(line => line.trim());
          const results = [];

          for (const equation of equations) {
            const trimmedEquation = equation.trim();
            if (!trimmedEquation) continue;

            // Buscar ecuaciones como "result = expression"
            const eqMatch = trimmedEquation.match(/^(\w+)\s*=\s*(.+)$/);
            if (eqMatch) {
              const [, resultVar, expression] = eqMatch;

              try {
                const result = this.evaluateExpression(expression, variables);
                variables[resultVar] = result;
                results.push(`${resultVar} = ${result}`);
              } catch (error) {
                throw new Error(`Error en ecuaci√≥n "${trimmedEquation}": ${error.message}`);
              }
            } else {
              // Evaluaci√≥n directa
              try {
                const result = this.evaluateExpression(trimmedEquation, variables);
                results.push(`${trimmedEquation} = ${result}`);
              } catch (error) {
                throw new Error(`Error al evaluar "${trimmedEquation}": ${error.message}`);
              }
            }
          }

          if (results.length === 0) {
            this.showResult('No se encontraron ecuaciones v√°lidas para calcular', 'warning');
          } else {
            this.showResult(results.join('\n'), 'success');
          }

        } catch (error) {
          this.showResult(`Error: ${error.message}`, 'error');
        }
      }

      // Mostrar resultados en la interfaz (mejora visual con iconos/estados)
      showResult(message, type = 'success') {
        this.resultDiv.textContent = message;

        // Reset clases de estado
        this.resultCard.classList.remove('is-success', 'is-error', 'is-warning');

        // Iconos por estado
        const icons = {
          success: '‚úÖ',
          error: '‚õî',
          warning: '‚ÑπÔ∏è'
        };
        this.resultIcon.textContent = icons[type] || '‚ÑπÔ∏è';

        // Estado visual
        if (type === 'success') {
          this.resultCard.classList.add('is-success');
        } else if (type === 'error') {
          this.resultCard.classList.add('is-error');
        } else {
          this.resultCard.classList.add('is-warning');
        }
      }
    }

    // Inicializar cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', () => {
      new Calculator();
    });
  </script>
</body>
</html>